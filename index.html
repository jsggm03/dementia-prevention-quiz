<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì˜¤ëŠ˜ì˜ ë‘ë‡Œ í™œë™</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Malgun Gothic',sans-serif;
  background:linear-gradient(135deg,#667eea,#764ba2);
  min-height:100vh;padding:20px
}
.container{max-width:900px;margin:0 auto}
h1{text-align:center;color:white;margin-bottom:20px}

.card{
  background:white;border-radius:18px;
  padding:24px;margin-bottom:20px;
  box-shadow:0 10px 30px rgba(0,0,0,.2)
}
.title{font-size:1.4em;margin-bottom:10px}
.desc{color:#444;line-height:1.6}

input{
  width:100%;padding:14px;font-size:1.1em;
  border-radius:10px;border:2px solid #ccc;margin-top:10px
}

.btn{
  width:100%;padding:16px;
  background:linear-gradient(135deg,#667eea,#764ba2);
  color:white;border:none;border-radius:12px;
  font-size:1.2em;cursor:pointer;
  margin-top:20px
}

.grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:18px;
  justify-items:center;
  margin-top:15px
}

/* ì¹´ë“œ ë’¤ì§‘ê¸° */
.flip-card{
  width:120px;height:190px;
  perspective:1000px;cursor:pointer
}
.flip-inner{
  width:100%;height:100%;
  transition:transform .6s;
  transform-style:preserve-3d;
  position:relative
}
.flip-card.flipped .flip-inner{
  transform:rotateY(180deg)
}
.flip-face{
  position:absolute;width:100%;height:100%;
  backface-visibility:hidden;border-radius:14px
}
.flip-front{transform:rotateY(180deg)}
.flip-face img{
  width:100%;height:100%;border-radius:14px
}

.selected{
  outline:4px solid #667eea
}

.option{
  padding:14px;border-radius:12px;
  border:2px solid #ddd;
  margin-top:10px;cursor:pointer
}
.option.selected{
  background:#667eea;color:white;border-color:#667eea
}

@media(max-width:600px){
  .grid{grid-template-columns:repeat(3,1fr)}
  .flip-card{width:100px;height:160px}
}
</style>
</head>

<body>
<div class="container">
<h1>ğŸ§  ì˜¤ëŠ˜ì˜ ë‘ë‡Œ í™œë™</h1>
<div id="app"></div>
</div>

<!-- D-ID ì•„ë°”íƒ€ -->
<script type="module"
  src="https://agent.d-id.com/v2/index.js"
  data-mode="fabio"
  data-client-key="Z29vZ2xlLW9hdXRoMnwxMTI3NjQ3MzA0NTM3NjA0MTgyMTI6d01EN0x6bFFFMmlZSk9nUHNacXll"
  data-agent-id="v2_agt_adow2aMU"
  data-name="did-agent"
  data-monitor="true"
  data-position="right">
</script>

<script>
const app=document.getElementById('app');
let userName='';

/* í™”íˆ¬ ì¹´ë“œ */
const deck=[
 {id:1,img:'/hwatu/01_pine.png'},
 {id:2,img:'/hwatu/02_plum.png'},
 {id:3,img:'/hwatu/03_cherry.png'},
 {id:4,img:'/hwatu/04_wisteria.png'},
 {id:5,img:'/hwatu/05_iris.png'},
 {id:6,img:'/hwatu/06_peony.png'},
 {id:7,img:'/hwatu/07_bushclover.png'},
 {id:8,img:'/hwatu/08_grass.png'},
 {id:9,img:'/hwatu/09_chrysanthemum.png'},
 {id:10,img:'/hwatu/10_maple.png'},
 {id:11,img:'/hwatu/11_paulownia.png'},
 {id:12,img:'/hwatu/12_rain.png'}
];

let shuffled=[], selected=[], recallCorrect=0;
let wordScore=0, healthScore=0;

/* ===== ì‹œì‘ í™”ë©´ ===== */
function intro(){
  app.innerHTML=`
  <div class="card">
    <div class="title">ì˜¤ëŠ˜ì˜ ë‘ë‡Œ í™œë™ì— ì˜¤ì…¨ì–´ìš”</div>
    <div class="desc">
      ì´ ì‹œê°„ì€ ë¨¸ë¦¬ë¥¼ ì‹œí—˜í•˜ëŠ” ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤.<br>
      ì¹´ë“œì™€ ë‹¨ì–´ë¥¼ ë³´ë©° ë¨¸ë¦¬ë¥¼ ì‚´ì§ ê¹¨ì›Œë³´ëŠ” ì‹œê°„ì´ì—ìš”.<br><br>
      ì˜í•˜ê³  ëª»í•˜ê³ ëŠ” ì „í˜€ ì¤‘ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
      ì²œì²œíˆ, í¸í•œ ë§ˆìŒìœ¼ë¡œ í•´ë³´ì‹œë©´ ë©ë‹ˆë‹¤.
    </div>
    <input id="nameInput" placeholder="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
    <button class="btn" onclick="start()">ì‹œì‘í•˜ê¸°</button>
  </div>`;
}

/* ===== ì¹´ë“œ ì„ íƒ ===== */
function start(){
  userName=document.getElementById('nameInput').value.trim();
  if(!userName){alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');return;}

  selected=[];
  shuffled=[...deck].sort(()=>Math.random()-0.5);

  app.innerHTML=`
  <div class="card">
    <div class="title">ì˜¤ëŠ˜ì˜ í™”íˆ¬ ì¹´ë“œ</div>
    <div class="desc">ë§ˆìŒì— ë“œëŠ” ì¹´ë“œ ì„¸ ì¥ì„ ê³¨ë¼ì£¼ì„¸ìš”.</div>
    <div class="grid">
      ${shuffled.map((c,i)=>`
        <div class="flip-card" onclick="pick(${i},this)">
          <div class="flip-inner">
            <div class="flip-face">
              <img src="/hwatu/back.png">
            </div>
            <div class="flip-face flip-front">
              <img src="${c.img}">
            </div>
          </div>
        </div>`).join('')}
    </div>
  </div>`;
}

function pick(i,el){
  const card=shuffled[i];
  if(selected.some(c=>c.id===card.id))return;
  if(selected.length>=3)return;
  el.classList.add('flipped','selected');
  selected.push(card);
  if(selected.length===3)setTimeout(memory,800);
}

/* ===== ê¸°ì–µ ===== */
function memory(){
  app.innerHTML=`
  <div class="card">
    <div class="title">ì¹´ë“œë¥¼ í•œ ë²ˆ ì‚´í´ë³¼ê²Œìš”</div>
    <div class="desc">
      ë°©ê¸ˆ ê³ ë¥¸ ì¹´ë“œ ì„¸ ì¥ì…ë‹ˆë‹¤.<br>
      ì ì‹œ ëˆˆìœ¼ë¡œë§Œ ì²œì²œíˆ ë´ì£¼ì„¸ìš”.<br><br>
      ì¡°ê¸ˆ ìˆë‹¤ê°€ ì´ ì¹´ë“œë“¤ì„ ë‹¤ì‹œ ê³¨ë¼ë³´ëŠ” ì‹œê°„ì´ ìˆì–´ìš”.
    </div>
    <div class="grid">
      ${selected.map(c=>`<img src="${c.img}" style="width:120px;border-radius:14px">`).join('')}
    </div>
  </div>`;
  setTimeout(recall,5000);
}

/* ===== íšŒìƒ ===== */
function recall(){
  recallCorrect=0;
  shuffled=[...deck].sort(()=>Math.random()-0.5);
  let picked=[];
  app.innerHTML=`
  <div class="card">
    <div class="title">ì•„ê¹Œ ë³¸ ì¹´ë“œ, ê¸°ì–µë‚˜ì‹œë‚˜ìš”?</div>
    <div class="desc">
      ì•„ë˜ ì¹´ë“œë“¤ ì¤‘ì—ì„œ<br>
      ì•„ê¹Œ ë³´ì•˜ë˜ ì¹´ë“œ ì„¸ ì¥ì„ ë‹¤ì‹œ ê³¨ë¼ì£¼ì„¸ìš”.
    </div>
    <div class="grid">
      ${shuffled.map((c,i)=>`
        <img src="${c.img}"
          style="width:120px;border-radius:14px;cursor:pointer"
          onclick="chooseRecall(${i},this)">`).join('')}
    </div>
  </div>`;

  window.chooseRecall=(i,el)=>{
    const card=shuffled[i];
    if(picked.some(p=>p.id===card.id))return;
    if(picked.length>=3)return;
    el.classList.add('selected');
    picked.push(card);
    if(picked.length===3){
      recallCorrect=picked.filter(p=>selected.some(s=>s.id===p.id)).length;
      setTimeout(message,800);
    }
  }
}

/* ===== í–‰ìš´ ë©”ì‹œì§€ ===== */
function message(){
  let msg='';
  if(recallCorrect===3){
    msg=`ì˜¤ëŠ˜ ê¸°ì–µë ¥ì´ ì°¸ ì¢‹ì•„ìš”.<br>ì´ì–´ì„œ ë‹¨ì–´ í™œë™ì„ í•´ë³¼ê¹Œìš”?`;
  }else if(recallCorrect>0){
    msg=`ì²œì²œíˆ ìƒê°í•˜ì‹  ê²Œ ì°¸ ì¢‹ì•˜ì–´ìš”.<br>ë§ì„ ìƒê°í•´ë³´ëŠ” í™œë™ìœ¼ë¡œ ë„˜ì–´ê°€ë³¼ê²Œìš”.`;
  }else{
    msg=`ê´œì°®ì•„ìš”, ì—°ìŠµ ì¤‘ì´ì—ìš”.<br>ë¶€ë‹´ ì—†ì´ ë‹¨ì–´ë¥¼ ê³¨ë¼ë³¼ê²Œìš”.`;
  }
  app.innerHTML=`
  <div class="card">
    <div class="title">ì˜¤ëŠ˜ì˜ í–‰ìš´ ë©”ì‹œì§€</div>
    <div class="desc">${msg}</div>
    <button class="btn" onclick="wordQuiz()">ë‹¤ìŒ</button>
  </div>`;
}

/* ===== ë‚±ë§ í€´ì¦ˆ ===== */
const words=[
 {q:'ë§ˆìŒì´ ì¡°ê¸‰í•˜ì§€ ì•Šì€ ìƒíƒœ',o:['ì—¬ìœ ','ê¸´ì¥','í˜¼ë€','ë¶„ì£¼'],c:0},
 {q:'ëŒ€ì¶© ì²˜ë¦¬í•˜ëŠ” íƒœë„',o:['ì„±ì‹¤','ê¼¼ê¼¼','ì†Œí™€','ì² ì €'],c:2},
 {q:'ì¡°ìš©íˆ ìŠ¬ë©°ì‹œ',o:['ì€ê·¼íˆ','ê¸‰íˆ','í¬ê²Œ','ê°‘ìê¸°'],c:0},
 {q:'í•´ë‚´ì„œ ë§Œì¡±ìŠ¤ëŸ¬ìš´ ìƒíƒœ',o:['ë¿Œë“¯','ë¶ˆì•ˆ','í—ˆì „','ê±±ì •'],c:0},
 {q:'ì¹¨ì°©í•˜ê³  ì¡°ìš©í•¨',o:['ì°¨ë¶„','ì‚°ë§Œ','ê¸‰í•¨','ì–´ìˆ˜ì„ '],c:0}
];

function wordQuiz(){
  wordScore=0;
  app.innerHTML=`<div class="card"><div class="title">ë‹¨ì–´ë¥¼ í•œ ë²ˆ ìƒê°í•´ë³¼ê¹Œìš”?</div></div>`;
  words.forEach(w=>{
    app.innerHTML+=`
    <div class="card">
      <div class="desc">${w.q}</div>
      ${w.o.map((o,i)=>`
        <div class="option" onclick="this.classList.toggle('selected');if(${i}===${w.c})wordScore++">${o}</div>`).join('')}
    </div>`;
  });
  app.innerHTML+=`<button class="btn" onclick="healthQuiz()">ë‹¤ìŒ</button>`;
}

/* ===== ì¹˜ë§¤ ì˜ˆë°© í€´ì¦ˆ ===== */
const health=[
 {q:'ì¹˜ë§¤ ì˜ˆë°©ì— ì¢‹ì€ í™œë™ì€?',o:['TV','ìš´ë™+ë‘ë‡Œ','í˜¼ì','í¸ì‹'],c:1},
 {q:'ê¸°ì–µë ¥ì— ë‚˜ìœ ìŒì‹ì€?',o:['ìƒì„ ','ê²¬ê³¼','ì±„ì†Œ','íŒ¨ìŠ¤íŠ¸í‘¸ë“œ'],c:3},
 {q:'ì¹˜ë§¤ ì´ˆê¸° ì¦ìƒì€?',o:['ìµœê·¼ ê¸°ì–µ ì €í•˜','ì™„ë²½ ê¸°ì–µ','ê³¼ìˆ˜ë©´','ë¬´'],c:0},
 {q:'ê¶Œì¥ ìˆ˜ë©´ ì‹œê°„ì€?',o:['4ì‹œê°„','6ì‹œê°„','7~8ì‹œê°„','10ì‹œê°„'],c:2},
 {q:'ì‚¬íšŒí™œë™ì˜ íš¨ê³¼ëŠ”?',o:['ë‡Œ ìê·¹','ëˆ','ì‹ì‚¬','ìš´ë™'],c:0}
];

function healthQuiz(){
  healthScore=0;
  app.innerHTML='';
  health.forEach(h=>{
    app.innerHTML+=`
    <div class="card">
      <div class="desc">${h.q}</div>
      ${h.o.map((o,i)=>`
        <div class="option" onclick="this.classList.toggle('selected');if(${i}===${h.c})healthScore++">${o}</div>`).join('')}
    </div>`;
  });
  app.innerHTML+=`<button class="btn" onclick="save()">ê²°ê³¼ ì €ì¥</button>`;
}

/* ===== ì €ì¥ ===== */
async function save(){
  await fetch('/.netlify/functions/save-answer',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      userName,
      recallCorrect,
      wordScore,
      healthScore,
      timestamp:new Date().toISOString()
    })
  });
  app.innerHTML=`
  <div class="card">
    <div class="title">ì˜¤ëŠ˜ë„ ìˆ˜ê³  ë§ìœ¼ì…¨ì–´ìš”</div>
    <div class="desc">
      ì˜¤ëŠ˜ í•˜ì‹  ë‘ë‡Œ í™œë™ì´ ì˜ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
      ë‚´ì¼ ë˜ ìƒê°ë‚˜ë©´ í•œ ë²ˆ ë” í•´ë³´ì…”ë„ ì¢‹ì•„ìš”.
    </div>
  </div>`;
}

intro();
</script>
</body>
</html>
